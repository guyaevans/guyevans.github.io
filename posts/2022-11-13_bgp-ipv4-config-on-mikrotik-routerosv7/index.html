<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>BGP IPv4 Config on Mikrotik RouterOSv7 -</title><script src=https://identity.netlify.com/v1/netlify-identity-widget.js></script><meta name=Description content="Sysadmin -- Net Admin -- IT Tech -- DIYer"><meta property="og:title" content="BGP IPv4 Config on Mikrotik RouterOSv7"><meta property="og:description" content="So I know a couple people who run their ASNs on Mikrotik routers (running RouterOS) as their hardware is cheap and easy to find. That includes me, I run BGP on their CHR image to announce my own ASN and IP v4 and V6 subnets. RouterOS CHR which is an image of RouterOS that you can run on your own hardware.
You would prevously use RouterOS version 6, but now version 7 has a couple stable releases and is supposed to be more stable and faster for BGP, I thought I would post some of my configs for version 7 as the config syntax has changed quite a bit."><meta property="og:type" content="article"><meta property="og:url" content="https://evans.fr/posts/2022-11-13_bgp-ipv4-config-on-mikrotik-routerosv7/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-13T00:00:00+00:00"><meta property="article:modified_time" content="2022-11-13T00:00:00+00:00"><meta property="og:site_name" content="Guy Evans"><meta name=twitter:card content="summary"><meta name=twitter:title content="BGP IPv4 Config on Mikrotik RouterOSv7"><meta name=twitter:description content="So I know a couple people who run their ASNs on Mikrotik routers (running RouterOS) as their hardware is cheap and easy to find. That includes me, I run BGP on their CHR image to announce my own ASN and IP v4 and V6 subnets. RouterOS CHR which is an image of RouterOS that you can run on your own hardware.
You would prevously use RouterOS version 6, but now version 7 has a couple stable releases and is supposed to be more stable and faster for BGP, I thought I would post some of my configs for version 7 as the config syntax has changed quite a bit."><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://evans.fr/posts/2022-11-13_bgp-ipv4-config-on-mikrotik-routerosv7/><link rel=prev href=https://evans.fr/posts/2022-11-04_vps-to-a-coloed-server-my-homelab-journey/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"BGP IPv4 Config on Mikrotik RouterOSv7","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/evans.fr\/posts\/2022-11-13_bgp-ipv4-config-on-mikrotik-routerosv7\/"},"genre":"posts","keywords":"routeros, mikrotik, routerosv7, bgp, configs","wordcount":630,"url":"https:\/\/evans.fr\/posts\/2022-11-13_bgp-ipv4-config-on-mikrotik-routerosv7\/","datePublished":"2022-11-13T00:00:00+00:00","dateModified":"2022-11-13T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Guy Evans"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title>My cool site</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/about/>~ Whoami </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="menu-item language" title="Select Language"><i class="fa fa-globe" aria-hidden=true></i>
<select class=language-select id=language-select-desktop onchange="location=this.value"><option value=/posts/2022-11-13_bgp-ipv4-config-on-mikrotik-routerosv7/ selected>English</option><option value=/fr/posts/2022-11-13_bgp-ipv4-config-on-mikrotik-routerosv7/>Français</option></select></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title>My cool site</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/about/ title>~ Whoami</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class=menu-item title="Select Language"><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select onchange="location=this.value"><option value=/posts/2022-11-13_bgp-ipv4-config-on-mikrotik-routerosv7/ selected>English</option><option value=/fr/posts/2022-11-13_bgp-ipv4-config-on-mikrotik-routerosv7/>Français</option></select></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">BGP IPv4 Config on Mikrotik RouterOSv7</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Guy Evans</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-11-13>2022-11-13</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;630 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;3 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/posts/2022-11-13_bgp-ipv4-config-on-mikrotik-routerosv7/screen-router.png data-srcset="/posts/2022-11-13_bgp-ipv4-config-on-mikrotik-routerosv7/screen-router.png, /posts/2022-11-13_bgp-ipv4-config-on-mikrotik-routerosv7/screen-router.png 1.5x, /posts/2022-11-13_bgp-ipv4-config-on-mikrotik-routerosv7/screen-router.png 2x" data-sizes=auto alt=/posts/2022-11-13_bgp-ipv4-config-on-mikrotik-routerosv7/screen-router.png title=/posts/2022-11-13_bgp-ipv4-config-on-mikrotik-routerosv7/screen-router.png width=1844 height=711></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#wait-asn-bgp-youve-lost-me->Wait! ASN, BGP, You&rsquo;ve lost me &mldr;</a></li><li><a href=#what-does-the-config-look-like>What does the config look like?</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>So I know a couple people who run their ASNs on Mikrotik routers (running RouterOS) as their hardware is cheap and easy to find. That includes me, I run BGP on their CHR image to announce my own ASN and IP v4 and V6 subnets. RouterOS CHR which is an image of RouterOS that you can run on your own hardware.</p><p>You would prevously use RouterOS version 6, but now version 7 has a couple stable releases and is supposed to be more stable and faster for BGP, I thought I would post some of my configs for version 7 as the config syntax has changed quite a bit. Today I&rsquo;ll focus on IPv4 but IPv6 is pretty much the same.</p><h3 id=wait-asn-bgp-youve-lost-me->Wait! ASN, BGP, You&rsquo;ve lost me &mldr;</h3><h4 id=what-is-bgp>What is BGP?</h4><blockquote><p>Border Gateway Protocol (BGP) is the postal service of the Internet. When someone drops a letter into a mailbox, the Postal Service processes that piece of mail and chooses a fast, efficient route to deliver that letter to its recipient<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p></blockquote><h4 id=what-is-an-autonomous-system-and-asns>What is an autonomous system and ASNs?</h4><blockquote><p>The Internet is a network of networks*, and autonomous systems are the big networks that make up the Internet. More specifically, an autonomous system (AS) is a large network or group of networks that has a unified routing policy. Every computer or device that connects to the Internet is connected to an AS.</p></blockquote><blockquote><p>Each AS is assigned an official number, or autonomous system number (ASN), similar to how every business has a business license with an unique, official number. But unlike businesses, external parties often refer to ASes by their number alone.
<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></p></blockquote><p><img class=lazyload src=/svg/loading.min.svg data-src="https://media4.giphy.com/media/U09CkmV0ewDbfGgAZR/giphy.gif?cid=790b7611acdfb9df5539d54ed990cfdf2d9c2469aaf1eee6&rid=giphy.gif&ct=g" data-srcset="https://media4.giphy.com/media/U09CkmV0ewDbfGgAZR/giphy.gif?cid=790b7611acdfb9df5539d54ed990cfdf2d9c2469aaf1eee6&rid=giphy.gif&ct=g, https://media4.giphy.com/media/U09CkmV0ewDbfGgAZR/giphy.gif?cid=790b7611acdfb9df5539d54ed990cfdf2d9c2469aaf1eee6&rid=giphy.gif&ct=g 1.5x, https://media4.giphy.com/media/U09CkmV0ewDbfGgAZR/giphy.gif?cid=790b7611acdfb9df5539d54ed990cfdf2d9c2469aaf1eee6&rid=giphy.gif&ct=g 2x" data-sizes=auto alt="https://media4.giphy.com/media/U09CkmV0ewDbfGgAZR/giphy.gif?cid=790b7611acdfb9df5539d54ed990cfdf2d9c2469aaf1eee6&rid=giphy.gif&ct=g" title="That&amp;rsquo;s pretty slick gif"></p><h3 id=what-does-the-config-look-like>What does the config look like?</h3><p>Here are my config exports to announce one subnet via AS 211486. As you can see, before doing anything you need to add your prefixes that you want to announce to a network list which you will specify in the bgp template. The rest should be pretty self explanitory but I&rsquo;ve detailed the main points below.</p><h4 id=network-list>Network List</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>/ip firewall address-list
</span></span><span class=line><span class=cl>add <span class=nv>address</span><span class=o>=</span>185.133.194.0/24 <span class=nv>list</span><span class=o>=</span>bgp
</span></span></code></pre></div><h4 id=templates>Templates</h4><p>ROSv7 also introduced the concept of templates to BGP, you could define one template for iBGP, one for IXPs and another for eBGP</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>/routing bgp template
</span></span><span class=line><span class=cl>add <span class=nv>as</span><span class=o>=</span><span class=m>211486</span> <span class=nv>disabled</span><span class=o>=</span>no input.filter<span class=o>=</span>bgp-in <span class=nv>name</span><span class=o>=</span>as211486-public-out-ip4 output.filter-chain<span class=o>=</span>bgp-out .network<span class=o>=</span>bgp <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    routing-table<span class=o>=</span>main
</span></span><span class=line><span class=cl>add address-families<span class=o>=</span>ipv6 <span class=nv>as</span><span class=o>=</span><span class=m>211486</span> <span class=nv>disabled</span><span class=o>=</span>no <span class=nv>name</span><span class=o>=</span>as211486-public-out-ip6 output.network<span class=o>=</span>bgp routing-table<span class=o>=</span>main
</span></span></code></pre></div><h4 id=filters>Filters</h4><p>As with any BGP setup we have filters. Mikrotik changed the filter syntax in ROSv7, it feels quite a bit like bird. Their <a href=https://help.mikrotik.com/docs/display/ROS/Route+Selection+and+Filters#RouteSelectionandFilters-FilterSyntax target=_blank rel="noopener noreffer">reference</a> is pretty good.
Here is a basic set of incoming and outgoing filters. The first two lines allow any network routes under 0.0.0.0/0 but not 185.133.194.0/24 which is mine. The third line allows my prefix the be annonced and nothing else. If no filter is defined for a route it will be rejected.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>/routing filter rule
</span></span><span class=line><span class=cl>add <span class=nv>chain</span><span class=o>=</span>bgp-in <span class=nv>comment</span><span class=o>=</span><span class=s2>&#34;STD IPv4 IN Filter&#34;</span> <span class=nv>disabled</span><span class=o>=</span>no <span class=nv>rule</span><span class=o>=</span><span class=s2>&#34;if (dst in 0.0.0.0/0) {set bgp-local-pref 90; accept}&#34;</span>
</span></span><span class=line><span class=cl>add <span class=nv>chain</span><span class=o>=</span>bgp-in <span class=nv>comment</span><span class=o>=</span><span class=s2>&#34;STD IPv4 IN Filter&#34;</span> <span class=nv>disabled</span><span class=o>=</span>no <span class=nv>rule</span><span class=o>=</span><span class=s2>&#34;if (dst in 185.133.194.0/24) {reject}&#34;</span>
</span></span><span class=line><span class=cl>add <span class=nv>chain</span><span class=o>=</span>bgp-out <span class=nv>comment</span><span class=o>=</span><span class=s2>&#34;STD IPv4 OUT Filter&#34;</span> <span class=nv>disabled</span><span class=o>=</span>no <span class=nv>rule</span><span class=o>=</span><span class=s2>&#34;if ( dst == 185.133.194.0/24 ) {accept}&#34;</span>
</span></span></code></pre></div><h4 id=connection>Connection</h4><p>Lastly we add the connection which references the template, network list and filters we have just created.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>/routing bgp connection
</span></span><span class=line><span class=cl>add <span class=nv>as</span><span class=o>=</span><span class=m>211486</span> <span class=nv>disabled</span><span class=o>=</span>no input.filter<span class=o>=</span>bgp-in local.role<span class=o>=</span>ebgp <span class=nv>name</span><span class=o>=</span>ip4-mw output.filter-chain<span class=o>=</span>bgp-out .network<span class=o>=</span>bgp <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    remote.address<span class=o>=</span>80.67.167.166/32 router-id<span class=o>=</span>185.133.194.1 routing-table<span class=o>=</span>main <span class=nv>templates</span><span class=o>=</span>as211486-public-out-ip4
</span></span></code></pre></div><h4 id=blackhole-route>Blackhole route</h4><p>One thing I often forget is to add a blackhole route to my routing table for the prefixes I would like to announce. Without this, you may have the correct filters be nothing will be announced as the router will only announce prefixes in its routing table.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>/ip route
</span></span><span class=line><span class=cl>add blackhole <span class=nv>disabled</span><span class=o>=</span>no dst-address<span class=o>=</span>185.133.194.0/24
</span></span></code></pre></div><p>Congratulations! You are now announcing a network with BGP on Mikrotik RouterOSv7</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://i.giphy.com/media/D1wxiYaBi6euR8W0VX/giphy.webp data-srcset="https://i.giphy.com/media/D1wxiYaBi6euR8W0VX/giphy.webp, https://i.giphy.com/media/D1wxiYaBi6euR8W0VX/giphy.webp 1.5x, https://i.giphy.com/media/D1wxiYaBi6euR8W0VX/giphy.webp 2x" data-sizes=auto alt=https://i.giphy.com/media/D1wxiYaBi6euR8W0VX/giphy.webp title=congrats></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Source: What is BGP? | BGP routing explained - <a href=https://www.cloudflare.com/learning/security/glossary/what-is-bgp/ target=_blank rel="noopener noreffer">Cloudflare</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Source : What is an autonomous system? | What are ASNs? - <a href=https://www.cloudflare.com/learning/network-layer/what-is-an-autonomous-system/ target=_blank rel="noopener noreffer">Cloudflare</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-11-13</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://evans.fr/posts/2022-11-13_bgp-ipv4-config-on-mikrotik-routerosv7/ data-title="BGP IPv4 Config on Mikrotik RouterOSv7" data-hashtags=routeros,mikrotik,routerosv7,bgp,configs><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://evans.fr/posts/2022-11-13_bgp-ipv4-config-on-mikrotik-routerosv7/ data-hashtag=routeros><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://evans.fr/posts/2022-11-13_bgp-ipv4-config-on-mikrotik-routerosv7/ data-title="BGP IPv4 Config on Mikrotik RouterOSv7"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://evans.fr/posts/2022-11-13_bgp-ipv4-config-on-mikrotik-routerosv7/ data-title="BGP IPv4 Config on Mikrotik RouterOSv7"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://evans.fr/posts/2022-11-13_bgp-ipv4-config-on-mikrotik-routerosv7/ data-title="BGP IPv4 Config on Mikrotik RouterOSv7" data-image=screen-router.png><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/routeros/>routeros</a>,&nbsp;<a href=/tags/mikrotik/>mikrotik</a>,&nbsp;<a href=/tags/routerosv7/>routerosv7</a>,&nbsp;<a href=/tags/bgp/>bgp</a>,&nbsp;<a href=/tags/configs/>configs</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/2022-11-04_vps-to-a-coloed-server-my-homelab-journey/ class=prev rel=prev title="VPS to a coloed server, my homelab journey - Part 1"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>VPS to a coloed server, my homelab journey - Part 1</a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.108.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Guy Evans</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>