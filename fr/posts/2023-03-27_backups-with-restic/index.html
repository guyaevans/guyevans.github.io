<!doctype html><html lang=fr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Sauvegardes avec Restic - Guy Evans</title>
<script src=https://identity.netlify.com/v1/netlify-identity-widget.js></script><meta name=Description content="Sysadmin -- Net Admin -- IT Tech -- DIYer"><meta property="og:url" content="https://guy-evans.com/fr/posts/2023-03-27_backups-with-restic/"><meta property="og:site_name" content="Guy Evans"><meta property="og:title" content="Sauvegardes avec Restic"><meta property="og:description" content="Après avoir eu la chance de ne perdre aucune de mes données sauvegardées sur mon nextcloud après l’incendie d’OVH, j’ai commencé à chercher une solution de sauvegarde décente et j’ai trouvé Restic. Voyons comment cela fonctionne."><meta property="og:locale" content="fr"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-28T16:17:14+00:00"><meta property="article:modified_time" content="2023-03-28T16:17:14+00:00"><meta property="article:tag" content="Backups"><meta property="article:tag" content="Restic"><meta property="article:tag" content="Self-Hosted"><meta property="og:image" content="https://guy-evans.com/posts/2023-03-27_backups-with-restic/feature.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://guy-evans.com/posts/2023-03-27_backups-with-restic/feature.jpg"><meta name=twitter:title content="Sauvegardes avec Restic"><meta name=twitter:description content="Après avoir eu la chance de ne perdre aucune de mes données sauvegardées sur mon nextcloud après l&rsquo;incendie d&rsquo;OVH, j&rsquo;ai commencé à chercher une solution de sauvegarde décente et j&rsquo;ai trouvé Restic. Voyons comment cela fonctionne."><meta name=twitter:site content="@_guyevans"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=canonical href=https://guy-evans.com/fr/posts/2023-03-27_backups-with-restic/><link rel=prev href=https://guy-evans.com/fr/posts/2023-01-09_self-hosted-email-why-and-how/><link rel=next href=https://guy-evans.com/fr/posts/2023-04-23_a-look-at-caddy-a-simple-and-fast-web-server/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Sauvegardes avec Restic","inLanguage":"fr","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/guy-evans.com\/fr\/posts\/2023-03-27_backups-with-restic\/"},"genre":"posts","keywords":"backups, restic, self-hosted","wordcount":1246,"url":"https:\/\/guy-evans.com\/fr\/posts\/2023-03-27_backups-with-restic\/","datePublished":"2023-03-28T16:17:14+00:00","dateModified":"2023-03-28T16:17:14+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Guy Evans"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/fr/ title="Guy Evans">Guy Evans</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/fr/posts/>Postes </a><a class=menu-item href=/fr/about/>~ Whoami </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Changer de Thème">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="menu-item language" title="Choisir la langue"><i class="fa fa-globe" aria-hidden=true></i>
<select class=language-select id=language-select-desktop onchange="location=this.value"><option value=/posts/2023-03-27_backups-with-restic/>English</option><option value=/fr/posts/2023-03-27_backups-with-restic/ selected>Français</option></select></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/fr/ title="Guy Evans">Guy Evans</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/fr/posts/ title>Postes</a><a class=menu-item href=/fr/about/ title>~ Whoami</a><a href=javascript:void(0); class="menu-item theme-switch" title="Changer de Thème">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class=menu-item title="Choisir la langue"><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select onchange="location=this.value"><option value=/posts/2023-03-27_backups-with-restic/>English</option><option value=/fr/posts/2023-03-27_backups-with-restic/ selected>Français</option></select></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contenu</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Sauvegardes avec Restic</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/fr/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Guy Evans</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-03-28>2023-03-28</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1246 mots&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;6 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/posts/2023-03-27_backups-with-restic/immo-wegmann-htsvneqf5fg-unsplash.jpg data-srcset="/posts/2023-03-27_backups-with-restic/immo-wegmann-htsvneqf5fg-unsplash.jpg, /posts/2023-03-27_backups-with-restic/immo-wegmann-htsvneqf5fg-unsplash.jpg 1.5x, /posts/2023-03-27_backups-with-restic/immo-wegmann-htsvneqf5fg-unsplash.jpg 2x" data-sizes=auto alt=/posts/2023-03-27_backups-with-restic/immo-wegmann-htsvneqf5fg-unsplash.jpg title=/posts/2023-03-27_backups-with-restic/immo-wegmann-htsvneqf5fg-unsplash.jpg width=1280 height=848></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contenu</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#the-3-2-1-rule>The 3-2-1 Rule</a><ul><li><a href=#sauvegardes-locales>Sauvegardes Locales</a></li></ul></li><li><a href=#restic>Restic</a><ul><li><a href=#pourquoi-restic>Pourquoi Restic</a></li><li><a href=#installer-restic>Installer Restic</a></li><li><a href=#initialiser-le-dépôt-de-stockage>Initialiser le dépôt de stockage</a></li><li><a href=#la-sauvegarde>La Sauvegarde</a></li><li><a href=#restauration-des-photos-de-chats>Restauration des photos de chats</a></li><li><a href=#automatisation-avec-un-script-bash-et-cron>Automatisation avec un script Bash et Cron</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>Après avoir eu la chance de ne perdre aucune de mes données sauvegardées sur mon nextcloud suite à l&rsquo;incendie d&rsquo;OVH<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> &#x1f525; à Strasbourg. J&rsquo;ai cependant perdu le VPS qui hébergeait le site web de <a href=https://www.evansmedia.fr target=_blank rel="noopener noreffer">www.evansmedia.fr</a></p><blockquote><p>Les cordonniers sont toujours les plus mal chaussés, n&rsquo;est-ce pas ?</p><figure><img src=/img/this-is-fine.webp></figure></blockquote><p>Je suis peut-être devenu un peu paranoïaque en ce qui concerne les sauvegardes, en particulier pour tout ce qui est stocké dans mon Nextcloud, qui contient à peu près tout ce qui a trait à ma vie personnelle, y compris les photos de notre nouveau-né.</p><h2 id=the-3-2-1-rule>The 3-2-1 Rule</h2><p>J&rsquo;ai décidé de bâtir ma stratégie de sauvegarde sur la règle des 3-2-1 (et vous devriez en faire autant)</p><p>L&rsquo;idée qu&rsquo;une solution de sauvegarde minimale devrait comprendre trois copies des données, dont deux copies sur des supports différents et une copie distante (hors site).</p><figure><img src=./3-2-1-Backup-Rule.png></figure><h3 id=sauvegardes-locales>Sauvegardes Locales</h3><p><em>(Nous simulons ici la sauvegarde d&rsquo;un serveur local, mais la machine virtuelle que je sauvegarde est en fait hébergée dans un centre de données, je la sauvegarde donc localement à la maison)</em></p><p>Pour effectuer mes sauvegardes, j&rsquo;utilise deux outils, Proxmox Backup Server<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> qui est une application de sauvegarde construite par les créateurs de proxmox ; et Restic, une application moderne qui sauvegarde des fichiers vers des tas de services différents. Aujourd&rsquo;hui, nous allons nous concentrer sur un seul niveau de sauvegarde avec Restic.</p><h2 id=restic>Restic</h2><blockquote><p>restic est un logiciel de sauvegarde rapide, efficace et sûr. Il supporte les trois principaux systèmes d&rsquo;exploitation (Linux, macOS, Windows) et quelques autres plus petits (FreeBSD, OpenBSD).
<a href=https://restic.net/ target=_blank rel="noopener noreffer">https://restic.net/</a></p></blockquote><h3 id=pourquoi-restic>Pourquoi Restic</h3><ul><li>il est simple et rapide à utiliser</li><li>il permet de sauvegarder de nombreux emplacements de stockage différents, y compris des services auto-hébergés et en ligne (Amazon S3, Google Drive, Backblaze, etc.)</li><li>ses sauvegardes peuvent être entièrement <strong>chiffrées</strong></li><li>les restaurations sont simples et vous pouvez même monter le dépôt de sauvegarde et récupérer un seul fichier.</li></ul><h3 id=installer-restic>Installer Restic</h3><p>Tout d&rsquo;abord, nous devons installer Restic, c&rsquo;est aussi simple que d&rsquo;utiliser APT sur Ubuntu/Debian (dans mon cas d&rsquo;utilisation).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install restic
</span></span></code></pre></div><h3 id=initialiser-le-dépôt-de-stockage>Initialiser le dépôt de stockage</h3><p>La beauté de Restic est que vous pouvez utiliser à peu près n&rsquo;importe quel type de stockage (local, Amazon S3, Minio Server, Backblaze B2, Azure, Google Cloud Storage, SFTP, etc.) pour votre repo (dépot) de sauvegarde et l&rsquo;interface reste en grande partie la même. Dans ce cas, j&rsquo;utilise leur propre backend de stockage. <a href=https://github.com/restic/rest-server target=_blank rel="noopener noreffer"><strong>Rest-Server</strong></a></p><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw" aria-hidden=true></i>Rest-Server<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Rest Server est un serveur HTTP haute performance qui met en œuvre l&rsquo;API REST de restic. Il fournit un moyen sûr et efficace de sauvegarder des données à distance, en utilisant le client de sauvegarde restic via l&rsquo;API rest : URL.</div></div></div><p>Maintenant que vous avez choisi le backend de stockage pour votre dépôt, nous devons l&rsquo;initialiser.</p><p>Disons que nous voulons nommer les sauvegardes de notre dépôt et nous pouvons utiliser la commande suivante pour l&rsquo;initialiser.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>restic -r rest:http://my-rest-server:8000/backups init
</span></span></code></pre></div><p>Restic vous demandera de créer un mot de passe (gardez-le précieusement, nous en aurons besoin plus tard) et initialisera le dépôt. Nous pouvons utiliser <code>check</code> pour vérifier que le dépôt est initialisé.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>restic -r rest:http://my-rest-server:8000/backups check
</span></span><span class=line><span class=cl>enter password <span class=k>for</span> repository:
</span></span><span class=line><span class=cl>password is correct
</span></span><span class=line><span class=cl>create exclusive lock <span class=k>for</span> repository
</span></span><span class=line><span class=cl>load indexesY
</span></span><span class=line><span class=cl>check all packs
</span></span><span class=line><span class=cl>check snapshots, trees and blobs
</span></span><span class=line><span class=cl>no errors were found
</span></span></code></pre></div><h3 id=la-sauvegarde>La Sauvegarde</h3><p>Maintenant que nous avons un dépôt initialisé, nous pouvons commencer à sauvegarder nos photos de chats. Avec la commande <code>backup</code> et pointant vers le dépôt que nous avons créé. Ainsi, pour sauvegarder mon dossier <code>~/cat-pictures</code>, je lancerais la commande suivante</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>restic -r rest:http://my-rest-server:8000/backups backup ~/cat-pictures
</span></span></code></pre></div><p>Oui, c&rsquo;est aussi simple que ça &#x1f60e;</p><p>A chaque fois qu&rsquo;une sauvegarde est lancée, restic crée un snapshot, vous pouvez les lister en utilisant la commande <code>snapshot</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>restic -r rest:http://my-rest-server:8000/snapshots
</span></span><span class=line><span class=cl>enter password <span class=k>for</span> repository:
</span></span><span class=line><span class=cl>password is correct
</span></span><span class=line><span class=cl>ID        Date                 Host        Tags        Directory
</span></span><span class=line><span class=cl>----------------------------------------------------------------------
</span></span><span class=line><span class=cl>ac8721ec  2023-03-26 20:18:16  my-pc              /home/bounty/cat-pictures
</span></span><span class=line><span class=cl>----------------------------------------------------------------------
</span></span><span class=line><span class=cl><span class=m>1</span> snapshots
</span></span></code></pre></div><h3 id=restauration-des-photos-de-chats>Restauration des photos de chats</h3><p>Qu&rsquo;est-ce qu&rsquo;une sauvegarde si vous n&rsquo;avez pas testé une restauration ? Ce n&rsquo;est pas une sauvegarde parce que vous ne savez pas si elle a fonctionné.</p><p>Essayons donc de restaurer nos images de chats avec la commande <code>restore</code>. Nous devons spécifier l&rsquo;identifiant du snapshot <code>ac8721ec</code> et l&rsquo;endroit où nous voulons restaurer <code>~/restored-cat-pictures</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>restic -r rest:http://my-rest-server:8000/backups restore ac8721ec --target ~/restored-cat-pictures/
</span></span></code></pre></div><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw" aria-hidden=true></i>Astuces<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Vous pouvez utiliser <code>latest</code> à la place de l&rsquo;identifiant du snapshot pour référencer le dernier snapshot.</div></div></div><p>C&rsquo;est aussi simple que la sauvegarde, non ?<div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw" aria-hidden=true></i>Autres commandes et documentation<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Restic possède de nombreuses autres commandes utiles que vous pouvez trouver dans leur excellente <a href=https://restic.readthedocs.io target=_blank rel="noopener noreffer">documentation</a>.</div></div></div></p><h3 id=automatisation-avec-un-script-bash-et-cron>Automatisation avec un script Bash et Cron</h3><p>Les sauvegardes manuelles sont bien mais vous risquez d&rsquo;oublier de les exécuter, nous allons donc automatiser notre sauvegarde avec un script bash et une entrée cron. Et pour les points bonus, assurons-nous d&rsquo;avoir un moyen de nous envoyer un message en cas d&rsquo;échec. Mon script de base est ci-dessous, chaque action est expliquée dans les commentaires.</p><p><em>Note : mon script est loin d&rsquo;être parfait et peut contenir des erreurs, n&rsquo;hésitez pas à le corriger ou à suggérer des améliorations ci-dessous</em></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1>#This will run Restic backups</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Variables Restic</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>RESTIC_REPOSITORY</span><span class=o>=</span>rest:http://my-rest-server:8000/backups
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>RESTIC_PASSWORD</span><span class=o>=</span>super-secret-repo-password1234
</span></span><span class=line><span class=cl><span class=nv>RESTIC_Folder</span><span class=o>=</span><span class=s2>&#34;~/cat-pictures&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># On choisi ou on ecrit les logs</span>
</span></span><span class=line><span class=cl><span class=nv>Log_location</span><span class=o>=</span>/var/log/restic-nas.log
</span></span><span class=line><span class=cl><span class=c1># Variables Telegram (si elles ne sont pas utilisées, vous devez supprimer le bloc entier pour telegram)</span>
</span></span><span class=line><span class=cl><span class=nv>TELEGRAM_token</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=nv>TELEGRAM_chatid</span><span class=o>=</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Defini une fonction d&#39;horodatage</span>
</span></span><span class=line><span class=cl>timestamp<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>date <span class=s2>&#34;+%b %d %Y %T %Z&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Inserer l&#39;horodatage et l&#39;en-tête dans le journal</span>
</span></span><span class=line><span class=cl><span class=nb>printf</span> <span class=s2>&#34;\n\n&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;-------------------------------------------------------------------------------&#34;</span> <span class=p>|</span> tee -a <span class=nv>$Log_location</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;</span><span class=k>$(</span>timestamp<span class=k>)</span><span class=s2>: restic.sh - Rest Backup started&#34;</span> <span class=p>|</span> tee -a <span class=nv>$Log_location</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Executer des sauvegardes</span>
</span></span><span class=line><span class=cl><span class=nv>NAS_backup_log</span><span class=o>=</span><span class=k>$(</span>restic backup <span class=nv>$RESTIC_Folder</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$NAS_backup_log</span><span class=s2>&#34;</span> <span class=p>|</span> tee -a <span class=nv>$Log_location</span>
</span></span><span class=line><span class=cl><span class=c1>## Il s&#39;agit d&#39;un moyen simple de vérifier que la sauvegarde a été un succès et que les fichiers ont été ajoutés à la base de données, sinon nous échouons.</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=nv>$NAS_backup_log</span><span class=s2>&#34;</span> <span class=o>==</span> *<span class=s2>&#34;Added to the repo&#34;</span>** <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl><span class=c1>## Si la sauvegarde a été réussie, nous pouvons continuer et écrire le résultat dans le journal.</span>
</span></span><span class=line><span class=cl>	<span class=nb>printf</span> <span class=s2>&#34;\n\n&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nb>echo</span> <span class=s2>&#34;-------------------------------------------------------------------------------&#34;</span> <span class=p>|</span> tee -a <span class=nv>$Log_location</span>
</span></span><span class=line><span class=cl>	<span class=nb>echo</span> <span class=s2>&#34;</span><span class=k>$(</span>timestamp<span class=k>)</span><span class=s2>: restic.sh - COMPLETED - Rest Backup&#34;</span> <span class=p>|</span> tee -a <span class=nv>$Log_location</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl><span class=c1>## Si la sauvegarde échoue, nous écrivons dans le journal et envoyons un message sur Telegram.</span>
</span></span><span class=line><span class=cl>	<span class=nb>printf</span> <span class=s2>&#34;\n\n&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nb>echo</span> <span class=s2>&#34;-------------------------------------------------------------------------------&#34;</span> <span class=p>|</span> tee -a <span class=nv>$Log_location</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=k>$(</span>timestamp<span class=k>)</span><span class=s2>: restic.sh - FAILED - Rest Backup&#34;</span> <span class=p>|</span> tee -a <span class=nv>$Log_location</span>
</span></span><span class=line><span class=cl><span class=c1>## envoyer un message à telegram</span>
</span></span><span class=line><span class=cl>	curl -X POST https://api.telegram.org/<span class=nv>$TELEGRAM_token</span>/sendMessage <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	       	--data <span class=nv>parse_mode</span><span class=o>=</span>HTML --data <span class=nv>chat_id</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$TELEGRAM_chatid</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>		--data <span class=nv>text</span><span class=o>=</span><span class=s2>&#34;&lt;b&gt;</span><span class=k>$(</span>timestamp<span class=k>)</span><span class=s2>%0A FAILED - REST Backup&lt;/b&gt;%0A%0A&lt;pre&gt;</span><span class=nv>$NAS_backup_log</span><span class=s2>&lt;/pre&gt;&#34;</span> -4
</span></span><span class=line><span class=cl>	<span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></div><p>Une fois que nous avons sauvegardé notre script bash sous <code>~/restic_script.sh</code>, nous devons autoriser son exécution avec <code>chmod</code> et l&rsquo;ajouter à notre <a href=https://fr.wikipedia.org/wiki/Cron target=_blank rel="noopener noreffer">crontab</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chmod +x ~/restic_script.sh <span class=c1># permettre l&#39;exécution de notre script</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>crontab -e <span class=c1># éditer notre crontab</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Edit this file to introduce tasks to be run by cron.</span>
</span></span><span class=line><span class=cl><span class=o>[</span>...<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=c1># To define the time you can provide concrete values for</span>
</span></span><span class=line><span class=cl><span class=c1># minute (m), hour (h), day of month (dom), month (mon),</span>
</span></span><span class=line><span class=cl><span class=c1># and day of week (dow) or use &#39;*&#39; in these fields (for &#39;any&#39;).</span>
</span></span><span class=line><span class=cl><span class=o>[</span>...<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=c1># m h  dom mon dow   command</span>
</span></span><span class=line><span class=cl><span class=m>0</span> <span class=m>1</span> * * * ~/restic_script.sh <span class=c1># exécutera notre script tous les soirs à 1 heure du matin</span>
</span></span></code></pre></div><p>Vous avez maintenant automatisé vos sauvegardes.</p><p>Je suis sûr que vous avez une meilleure façon de procéder, pourquoi ne pas partager vos idées dans les commentaires ?</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><em>10 mars 2021</em> - Le site de l’entreprise OVH à Strasbourg touché par un « important incendie » - <a href=https://www.lemonde.fr/societe/article/2021/03/10/ target=_blank rel="noopener noreffer">Le Monde</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://www.proxmox.com/en/proxmox-backup-server target=_blank rel="noopener noreffer">Proxmox Backup Server</a> est une solution de sauvegarde qui permet de sauvegarder et de restaurer des VM, des conteneurs et des hôtes physiques.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Mis à jour le 2023-03-28</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Partager sur Twitter" data-sharer=twitter data-url=https://guy-evans.com/fr/posts/2023-03-27_backups-with-restic/ data-title="Sauvegardes avec Restic" data-via=_guyevans data-hashtags=backups,restic,self-hosted><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Partager sur Facebook" data-sharer=facebook data-url=https://guy-evans.com/fr/posts/2023-03-27_backups-with-restic/ data-hashtag=backups><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Partager sur Hacker News" data-sharer=hackernews data-url=https://guy-evans.com/fr/posts/2023-03-27_backups-with-restic/ data-title="Sauvegardes avec Restic"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Partager sur Line" data-sharer=line data-url=https://guy-evans.com/fr/posts/2023-03-27_backups-with-restic/ data-title="Sauvegardes avec Restic"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Partager sur 微博" data-sharer=weibo data-url=https://guy-evans.com/fr/posts/2023-03-27_backups-with-restic/ data-title="Sauvegardes avec Restic" data-image=immo-wegmann-htsvneqf5fg-unsplash.jpg><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/fr/tags/backups/>Backups</a>,&nbsp;<a href=/fr/tags/restic/>Restic</a>,&nbsp;<a href=/fr/tags/self-hosted/>Self-Hosted</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Retour</a></span>&nbsp;|&nbsp;<span><a href=/fr/>Accueil</a></span></section></div><div class=post-nav><a href=/fr/posts/2023-01-09_self-hosted-email-why-and-how/ class=prev rel=prev title="Mails auto-hébergé - Pourquoi et comment?"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Mails auto-hébergé - Pourquoi et comment?</a>
<a href=/fr/posts/2023-04-23_a-look-at-caddy-a-simple-and-fast-web-server/ class=next rel=next title="Découverte de Caddy - un serveur web simple et rapide">Découverte de Caddy - un serveur web simple et rapide<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><script data-isso=https://isso.evans.fr/ data-isso-id=thread-id data-isso-css=true data-isso-lang data-isso-reply-to-self=true data-isso-require-author=true data-isso-require-email=false data-isso-avatar=true data-isso-avatar-bg src=https://isso.evans.fr/js/embed.min.js></script><noscript>Please enable JavaScript to view the comments powered by <a href=https://posativ.org/isso/>Isso</a>.</noscript><div><section id=isso-thread></section></div></section></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Propulsé par <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.125.5">Hugo</a> | Thème - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/fr/ target=_blank>Guy Evans</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Retour en Haut"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="Afficher les Commentaires"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copier dans le presse-papiers",maxShownLines:50},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="//matomo.evans.fr/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></body></html>